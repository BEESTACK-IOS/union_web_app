<!doctype html>
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>
<html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>
<html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang=""> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>BÜRO MEMUR-SEN AYDIN ŞUBESİ</title>
    <meta name="description" content="Büro Memur Sendikası Aydın Şube Başkanlığı">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" href="static/images/logo2.png">
    <link rel="shortcut icon" href="static/images/logo2.png">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.0/normalize.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lykmapipo/themify-icons@0.1.2/css/themify-icons.css">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/pixeden-stroke-7-icon@1.2.3/pe-icon-7-stroke/dist/pe-icon-7-stroke.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.0/css/flag-icon.min.css">
    <link rel="stylesheet" href="static/assets/css/cs-skin-elastic.css">
    <link rel="stylesheet" href="static/assets/css/style.css">
    <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/html5shiv/3.7.3/html5shiv.min.js"></script> -->
    <link href="https://cdn.jsdelivr.net/npm/chartist@0.11.0/dist/chartist.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/jqvmap@1.5.1/dist/jqvmap.min.css" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/weathericons@2.1.0/css/weather-icons.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@3.9.0/dist/fullcalendar.min.css" rel="stylesheet"/>

    <style>
        #weatherWidget .currentDesc {
            color: #ffffff !important;
        }

        .traffic-chart {
            min-height: 335px;
        }

        #flotPie1 {
            height: 150px;
        }

        #flotPie1 td {
            padding: 3px;
        }

        #flotPie1 table {
            top: 20px !important;
            right: -10px !important;
        }

        .chart-container {
            display: table;
            min-width: 270px;
            text-align: left;
            padding-top: 10px;
            padding-bottom: 10px;
        }

        #flotLine5 {
            height: 105px;
        }

        #flotBarChart {
            height: 150px;
        }

        #cellPaiChart {
            height: 160px;
        }

    </style>
</head>

<body>
<aside id="left-panel" class="left-panel">
    <nav class="navbar navbar-expand-sm navbar-default">

        <div id="main-menu" class="main-menu collapse navbar-collapse">
            <ul class="nav navbar-nav">
                {% if (userrole == "super") or (userrole == "yönetici") %}
                <li>
                    <a href="index.html"><i class="menu-icon fa fa-laptop"></i>Admin Arayüzü </a>
                </li>
                {% endif %}
                <li class="menu-title">Menu</li><!-- /.menu-title -->
                <li>
                    <a href="/profil"> <i class="menu-icon fa fa-user"></i>Profilim </a>
                </li>
                <li>
                    <a href="widgets.html"> <i class="menu-icon fa fa-bullhorn"></i>Haberler </a>
                </li>
                <li>
                    <a href="widgets.html"> <i class="menu-icon fa fa-building-o"></i>Mağazalar </a>
                </li>
                <li>
                    <a href="/talep"> <i class="menu-icon ti-email"></i>Mesajlar </a>
                </li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </nav>
</aside>
<!-- /#left-panel -->

<!-- Right Panel -->

<div id="right-panel" class="right-panel">

    <!-- Header-->
    <header id="header" class="header">
        <div class="top-left">
            <div class="navbar-header">
                <a class="navbar-brand" href="./"><img src="static/images/logo4.png" alt="Logo"></a>
                <a class="navbar-brand hidden" href="./"><img src="static/images/logo2.png" alt="Logo"></a>
                <a id="menuToggle" class="menutoggle"><i class="fa fa-bars"></i></a>
            </div>
        </div>
        <div class="top-right">
            <div class="header-menu">
                <div class="header-left">

                    <div class="dropdown for-message">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="message"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fa fa-envelope"></i>
                            <span class="count bg-primary">{{notificationData|length}}</span>
                        </button>
                        <div class="dropdown-menu" aria-labelledby="message">
                            <p class="red">Toplam {{notificationData|length}} Talep Görüşmeniz var</p>

                            {% for tl in notificationData %}

                            <a class="dropdown-item media" href="http://localhost:5000/talep">
                                <span class="photo media-left"><img alt="avatar"
                                                                    src="static/images/admin.jpg"></span>
                                <div class="message media-body">
                                    <span class="name float-left">{{tl[0]}}</span>
                                    <span class="time float-right">Sonuçlanmamış talep/görüş konuşması</span>
                                </div>
                            </a>

                            {% endfor %}

                        </div>
                    </div>

                    <div class="user-area dropdown float-right">
                        <a href="#" class="dropdown-toggle active" data-toggle="dropdown" aria-haspopup="true"
                           aria-expanded="false">
                            <img class="user-avatar rounded-circle" src="static/images/admin.jpg" alt="User Avatar">
                        </a>

                        <div class="user-menu dropdown-menu">
                            <a class="nav-link" href="/profil"><i class="fa fa-user"></i>Profilim</a>

                            <a class="nav-link" href="/talep"><i class="fa fa-bell-o"></i>Mesajlarım <span
                                    class="count">{{notificationData|length}}</span></a>

                            <a class="nav-link" href="/logout"><i class="fa fa-power-off"></i>Çıkış Yap</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header><!-- /header -->
    <!-- Header-->
    <!-- Content -->
    <div class="content">
        <!-- Animated -->
        <div class="animated fadeIn">
            <!-- Widgets  -->
            <div class="row">
                <div class="col-lg-3 col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <div class="stat-widget-five">
                                <div class="stat-icon dib flat-color-1">
                                    <i class="pe-7s-cash"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="text-left dib">
                                        <div class="stat-text">$<span class="count">23569</span></div>
                                        <div class="stat-heading">Revenue</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <div class="stat-widget-five">
                                <div class="stat-icon dib flat-color-2">
                                    <i class="pe-7s-cart"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="text-left dib">
                                        <div class="stat-text"><span class="count">3435</span></div>
                                        <div class="stat-heading">Sales</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <div class="stat-widget-five">
                                <div class="stat-icon dib flat-color-3">
                                    <i class="pe-7s-browser"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="text-left dib">
                                        <div class="stat-text"><span class="count">349</span></div>
                                        <div class="stat-heading">Templates</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <div class="stat-widget-five">
                                <div class="stat-icon dib flat-color-4">
                                    <i class="pe-7s-users"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="text-left dib">
                                        <div class="stat-text"><span class="count">2986</span></div>
                                        <div class="stat-heading">Clients</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /Widgets -->

            <div class="clearfix"></div>
            <!-- Orders -->
            <div class="orders">
                <div class="row">
                    <div class="col-lg-8">

                        <div class="col-lg-12">
                            <div class="card">
                                <div class="card-header">
                                    <h4>Admin</h4>
                                </div>
                                <div class="card-body">
                                    <div class="custom-tab">

                                        <nav>
                                            <div class="nav nav-tabs" id="nav-tab" role="tablist">
                                                {% if (userrole == "super") %}
                                                <a class="nav-item nav-link active" id="custom-nav-home-tab"
                                                   data-toggle="tab" href="#custom-nav-home" role="tab"
                                                   aria-controls="custom-nav-home" aria-selected="true">Talep
                                                    Geçmişi</a>
                                                {% endif %}
                                                <a class="nav-item nav-link" id="custom-nav-profile-tab"
                                                   data-toggle="tab" href="#custom-nav-profile" role="tab"
                                                   aria-controls="custom-nav-profile" aria-selected="false">Sistem
                                                    Geçmişi</a>
                                                <a class="nav-item nav-link" id="custom-nav-magaza-tab"
                                                   data-toggle="tab" href="#custom-nav-contact" role="tab"
                                                   aria-controls="custom-nav-contact" aria-selected="false">Mağaza</a>
                                                <a class="nav-item nav-link" id="custom-nav-haberler-tab"
                                                   data-toggle="tab" href="#custom-nav-contact1" role="tab"
                                                   aria-controls="custom-nav-contact" aria-selected="false">Haberler</a>
                                            </div>
                                        </nav>
                                        <div class="tab-content pl-3 pt-2" id="nav-tabContent">
                                            <div class="tab-pane fade show active" id="custom-nav-home" role="tabpanel"
                                                 aria-labelledby="custom-nav-home-tab">
                                                {% if (userrole == "super") %}
                                                <div class="col-md-12">
                                                    <div class="card">
                                                        <div class="card-header">
                                                            <strong class="card-title">Talep İçin Kişiler</strong>
                                                        </div>
                                                        <div class="card-body">
                                                            <table id="bootstrap-data-table"
                                                                   class="table table-striped table-bordered">
                                                                <thead>
                                                                <tr>
                                                                    <th>Taraflar</th>
                                                                    <th>Talep Durumu</th>
                                                                    <th>Talep Tarihi</th>
                                                                    <th>Mesajları Aç</th>
                                                                </tr>
                                                                </thead>
                                                                <tbody>
                                                                {% for element in talepDataAssigned %}
                                                                <tr>
                                                                    <td>{{element[0]}}</td>
                                                                    {% if element[1] == 0 %}
                                                                    <td><span
                                                                            class="badge badge-primary">yeni talep</span>
                                                                    </td>
                                                                    {% elif element[1] == 1 %}
                                                                    <td><span
                                                                            class="badge badge-warning">görüş önerisi</span>
                                                                    </td>
                                                                    {% elif element[1] == 2 %}
                                                                    <td><span class="badge badge-success">talep karşılandı</span>
                                                                    </td>
                                                                    {% elif element[1] == 3 %}
                                                                    <td><span class="badge badge-danger">talep karşılanamadı</span>
                                                                    </td>
                                                                    {% endif %}
                                                                    <td>{{element[2]}}</td>
                                                                    <td>
                                                                        <button type="button" class="popUpButton"
                                                                                value="{{element[3]}}"
                                                                                recievername="{{element[6]}}"
                                                                                recieverid="{{element[4]}}"
                                                                                sendername="{{element[7]}}"
                                                                                senderid="{{element[5]}}"><i
                                                                                class="fa fa-comment"></i></button>
                                                                    </td>
                                                                </tr>
                                                                {% endfor %}

                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% endif %}
                                            </div>
                                            <div class="tab-pane fade" id="custom-nav-profile" role="tabpanel"
                                                 aria-labelledby="custom-nav-profile-tab">
                                                <div class="col-md-12">
                                                    <div class="card">
                                                        <div class="card-header">
                                                            <strong class="card-title">Talep İçin Kişiler</strong>
                                                        </div>
                                                        <div class="card-body">

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="tab-pane fade" id="custom-nav-contact" role="tabpanel"
                                                 aria-labelledby="custom-nav-contact-tab">
                                                <!-- firm insert  -->
                                                <div class="col-lg-12">
                                                    <div class="card">
                                                        <div class="card-header">
                                                            <strong>Mağaza Ekleme Formu</strong>
                                                        </div>
                                                        <div class="card-body card-block">
                                                            <form action="/admin" method="post"
                                                                  enctype="multipart/form-data"
                                                                  class="form-horizontal">
                                                                <div class="row form-group">
                                                                    <div class="col col-md-3"><label for="text-input"
                                                                                                     class=" form-control-label">Mağaza
                                                                        Adı
                                                                    </label></div>
                                                                    <div class="col-12 col-md-9"><input type="text"
                                                                                                        id="text-input"
                                                                                                        name="firm_name"
                                                                                                        placeholder="M. Adı"
                                                                                                        class="form-control">
                                                                    </div>
                                                                </div>

                                                                <div class="row form-group">
                                                                    <div class="col col-md-3"><label
                                                                            for="textarea-input"
                                                                            class=" form-control-label">Mağaza
                                                                        Açıklaması</label>
                                                                    </div>
                                                                    <div class="col-12 col-md-9"><textarea
                                                                            name="textarea-input" id="textarea-input"
                                                                            rows="9" placeholder="İçerik..."
                                                                            class="form-control" name="firm_content"></textarea></div>
                                                                </div>
                                                                <div class="row form-group">
                                                                    <div class="col col-md-3"><label for="file-input"
                                                                                                     class=" form-control-label">Resim
                                                                        Ekle </label></div>
                                                                    <div class="col-12 col-md-9"><input type="file"
                                                                                                        id="file-input"
                                                                                                        name="file-input"
                                                                                                        class="form-control-file" name="firm_logo">
                                                                    </div>
                                                                </div>
                                                                <div class="row form-group">
                                                                    <div class="col col-md-3"><label
                                                                            class=" form-control-label">Konum Verileri</label></div>
                                                                    <div class="col-4"><input type="number" step="0.000001"
                                                                                              placeholder="lat"
                                                                                              class="form-control" name="firm_lat">
                                                                    </div>
                                                                    <div class="col-4"><input type="number" step="0.000001"
                                                                                              placeholder="lng"
                                                                                              class="form-control" name="firm_lng">
                                                                    </div>
                                                                </div>
                                                                <div class="row form-group">
                                                                    <div class="col col-md-3"><label
                                                                            class=" form-control-label"></label></div>
                                                                    <div class="col-12 col-md-9">
                                                                        <button style="width: 100%;opacity: 0.5;"
                                                                                type="submit" class="btn btn-primary"
                                                                                 name="submits" value="firm_add">
                                                                            Ekle
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>


                                                <!-- firm insert end -->


                                            </div>
                                            <div class="tab-pane fade" id="custom-nav-contact1" role="tabpanel"
                                                 aria-labelledby="custom-nav-contact1-tab">
                                                <p>Raw denim you probably haven't heard of them jean shorts Austin.
                                                    Nesciunt tofu stumptown aliqua, retro synth master cleanse. Mustache
                                                    cliche tempor, williamsburg carles vegan helvetica. Reprehenderit
                                                    butcher retro keffiyeh dreamcatcher synth. Cosby sweater eu banh mi,
                                                    irure terry richardson ex sd. Alip placeat salvia cillum iphone.
                                                    Seitan alip s cardigan american apparel, butcher voluptate nisi
                                                    .</p>
                                            </div>
                                        </div>

                                    </div>
                                </div>


                            </div>
                        </div>
                    </div>

                    <div class="col-xl-4">
                        <div class="row">
                            <div class="col-lg-6 col-xl-12">
                                <div class="card br-0">
                                    <div class="card-body">
                                        <div class="chart-container ov-h">
                                            <div id="flotPie1" class="float-chart"></div>
                                        </div>
                                    </div>
                                </div><!-- /.card -->
                            </div>

                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-header"><strong>T.C. Kimlik Numarası Ekleme Formu</strong></div>
                                    <div class="card-body card-block">
                                        <div class="form-group"><label class=" form-control-label">T.C. Kimlik
                                            Numarası</label><input
                                                type="email" name="mail" id="mail" placeholder="{{usermail}}"
                                                class="form-control"></div>
                                        <div class="row form-group">
                                            <div class="col-8">
                                                <div class="form-group"><label class=" form-control-label">İlgili
                                                    Yetki</label><input type="password" name="past_pass" id="past_pass"
                                                                        class="form-control"></div>
                                                <span id='past_pass_message'></span>
                                            </div>
                                        </div>
                                        <span id='pass_message'></span>
                                        <span id='err_message'></span>
                                    </div>
                                    <button type="button" class="btn btn-primary" id="guncelle" style="opacity: 0.5;">
                                        Ekle
                                    </button>
                                </div>
                            </div>

                        </div>
                    </div><!-- .animated -->

                </div>
            </div> <!-- /.col-md-4 -->
        </div>
    </div>
    <!-- /.orders -->

    <div class="bg-modal">

        <div class="modal-content">

            <div class="card" style="width: 45vw;">
                <div class="card-body">
                    <h4 class="card-title box-title">Konuşma Geçmişi</h4>
                    <div class="close">+</div>
                    <div class="card-content">
                        <div class="messenger-box">

                            <ul id="message_content" style="overflow-y: scroll; height: 30vh;">

                            </ul>
                        </div><!-- /.messenger-box -->
                    </div>
                </div> <!-- /.card-body -->
            </div><!-- /.card -->
        </div>
    </div>
    <!-- /To Do and Live Chat -->


</div>
<!-- /#right-panel -->

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.4/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-match-height@0.7.2/dist/jquery.matchHeight.min.js"></script>
<script src="static/assets/js/main.js"></script>


<script src="static/assets/js/lib/data-table/datatables.min.js"></script>
<script src="static/assets/js/lib/data-table/dataTables.bootstrap.min.js"></script>
<script src="static/assets/js/lib/data-table/dataTables.buttons.min.js"></script>
<script src="static/assets/js/lib/data-table/buttons.bootstrap.min.js"></script>
<script src="static/assets/js/lib/data-table/jszip.min.js"></script>
<script src="static/assets/js/lib/data-table/vfs_fonts.js"></script>
<script src="static/assets/js/lib/data-table/buttons.html5.min.js"></script>
<script src="static/assets/js/lib/data-table/buttons.print.min.js"></script>
<script src="static/assets/js/lib/data-table/buttons.colVis.min.js"></script>
<script src="static/assets/js/init/datatables-init.js"></script>

<!--  Chart js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.7.3/dist/Chart.bundle.min.js"></script>

<!--Chartist Chart-->
<script src="https://cdn.jsdelivr.net/npm/chartist@0.11.0/dist/chartist.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartist-plugin-legend@0.6.2/chartist-plugin-legend.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/jquery.flot@0.8.3/jquery.flot.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flot-pie@1.0.0/src/jquery.flot.pie.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flot-spline@0.0.1/js/jquery.flot.spline.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/simpleweather@3.1.0/jquery.simpleWeather.min.js"></script>
<script src="static/assets/js/init/weather-init.js"></script>

<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@3.9.0/dist/fullcalendar.min.js"></script>
<script src="static/assets/js/init/fullcalendar-init.js"></script>
<script src="https://js.pusher.com/4.1/pusher.min.js"></script>

<!--Local Stuff-->
<script>
    jQuery(document).ready(function ($) {
        "use strict";

        // Pie chart flotPie1
        var piedata = [
            {label: "Desktop visits", data: [[1, 32]], color: '#5c6bc0'},
            {label: "Tab visits", data: [[1, 33]], color: '#ef5350'},
            {label: "Mobile visits", data: [[1, 35]], color: '#66bb6a'}
        ];

        $.plot('#flotPie1', piedata, {
            series: {
                pie: {
                    show: true,
                    radius: 1,
                    innerRadius: 0.65,
                    label: {
                        show: true,
                        radius: 2 / 3,
                        threshold: 1
                    },
                    stroke: {
                        width: 0
                    }
                }
            },
            grid: {
                hoverable: true,
                clickable: true
            }
        });
        // Pie chart flotPie1  End

        var currentUserId = $("#userid").val();
        var recieverid = ""
        var recievername = ""
        var senderid = ""
        var sendername = ""

        var sendedname = "";
        var sendedid = "";

        var getedname = "";
        var getedid = "";

        var sendedmessage = "";

        var pusher;
        var channelName = "";

        var messageSenderTemplate = `<li><div class="msg-sent msg-container"><div class="avatar"><img src="static/images/avatar/64-2.jpg" alt=""></div><div class="msg-box"><div class="inner-box"><div class="name">${sendedname}</div><div class="meg">${sendedmessage}</div></div></div></div></li>`;

        var messageRecieverTemplate = "";

        $(document).on('click', '.popUpButton',
            function () {
                document.querySelector('.bg-modal').style.display = 'flex';
                currentUserId = $(this).attr("senderid");
                recievername = $(this).attr("recievername");
                recieverid = $(this).attr("recieverid");
                sendername = $(this).attr("sendername");
                senderid = $(this).attr("senderid");

                // Enable pusher logging - don't include this in production
                Pusher.logToConsole = true;

                pusher = new Pusher('ed89289759f2f434f256', {
                    cluster: 'eu',
                    encrypted: true
                });

                channelName = $(this).val();

                var channel = pusher.subscribe(channelName);

                channel.bind('new-message', function (data) {
                    sendedname = data.username;
                    sendedid = data.userid;
                    sendedmessage = data.message;
                    getedname = data.recievername;
                    getedid = data.recieverid;
                    var mesDate = data.date;
                    var mesTime = data.time;

                    if (currentUserId == getedid) {
                        messageSenderTemplate = `<li><div class="msg-received msg-container"><div class="avatar"><img src="static/images/avatar/64-2.jpg" alt=""><div class="send-time">${mesTime} ${mesDate} </div></div><div class="msg-box"><div class="inner-box"><div class="name">${sendedname}</div><div class="meg">${sendedmessage}</div></div></div></div></li>`;
                    } else {
                        messageSenderTemplate = `<li><div class="msg-sent msg-container"><div class="avatar"><img src="static/images/avatar/64-2.jpg" alt=""><div class="send-time"> ${mesTime} ${mesDate} </div> </div><div class="msg-box"><div class="inner-box"><div class="name">${sendedname}</div><div class="meg">${sendedmessage}</div></div></div></div></li>`;
                    }
                    $("#message_content").append(messageSenderTemplate);
                    document.querySelector("#message_content").scrollTop = document.querySelector("#message_content").scrollHeight;
                });

                $.post('/messagehist', {'channelName': channelName}, function (returnData) {

                    var messagelist = returnData['message_data']
                    var i;
                    for (i = 0; i < messagelist.length; i++) {
                        if (currentUserId == messagelist[i][3]) {
                            messageSenderTemplate = `<li><div class="msg-received msg-container"><div class="avatar"><img src="static/images/avatar/64-2.jpg" alt=""><div class="send-time">${messagelist[i][5]} ${messagelist[i][6]} </div></div><div class="msg-box"><div class="inner-box"><div class="name">${recievername}</div><div class="meg">${messagelist[i][4]}</div></div></div></div></li>`;
                        } else {
                            messageSenderTemplate = `<li><div class="msg-sent msg-container"><div class="avatar"><img src="static/images/avatar/64-2.jpg" alt=""><div class="send-time">${messagelist[i][5]} ${messagelist[i][6]} </div></div><div class="msg-box"><div class="inner-box"><div class="name">${sendername}</div><div class="meg">${messagelist[i][4]}</div></div></div></div></li>`;
                        }
                        $("#message_content").append(messageSenderTemplate);
                    }

                });
            });


        document.querySelector('.close').addEventListener('click',
            function () {
                document.querySelector('.bg-modal').style.display = 'none';
                pusher.unsubscribe(channelName);
                $('#message_content').empty();
            });

    });
</script>
</body>
</html>
